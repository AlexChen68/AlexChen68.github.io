import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.01af844e.js";const u=JSON.parse('{"title":"本机虚拟机集群搭建","description":"","frontmatter":{"title":"本机虚拟机集群搭建","date":"2023-10-17T00:00:00.000Z","order":999},"headers":[],"relativePath":"devops/deploy/vm-cluster.md","filePath":"devops/deploy/vm-cluster.md","lastUpdated":1707632099000}'),p={name:"devops/deploy/vm-cluster.md"},e=l(`<h1 id="本机虚拟机集群搭建" tabindex="-1">本机虚拟机集群搭建 <a class="header-anchor" href="#本机虚拟机集群搭建" aria-label="Permalink to &quot;本机虚拟机集群搭建&quot;">​</a></h1><h2 id="目标" tabindex="-1">目标 <a class="header-anchor" href="#目标" aria-label="Permalink to &quot;目标&quot;">​</a></h2><p>配置集群部署需要的环境，这里以最少节点的 3 台虚拟机为例，采用 <code>VMware Workstation Pro</code> 创建虚拟机，三台机器打通网络，互相配置 ssh 免密登录。</p><h2 id="创建虚拟机" tabindex="-1">创建虚拟机 <a class="header-anchor" href="#创建虚拟机" aria-label="Permalink to &quot;创建虚拟机&quot;">​</a></h2><ol><li>安装 <code>VMware Workstation Pro</code>，windows 激活码 <code>MC60H-DWHD5-H80U9-6V85M-8280D</code>;</li><li>下载 Centos7 ISO 镜像，下载地址：<a href="https://mirrors.tuna.tsinghua.edu.cn/centos/7.9.2009/isos/x86_64/" target="_blank" rel="noreferrer">清华大学开源软件镜像站</a>（DVD 标准版或 Minimal 最小版）。</li><li>使用 <code>VMware Workstation Pro</code> 版本在本地创建一台机器（可以先配置一台，配置好后再克隆），并选择 Centos7 操作系统，配置好网络、时区、主机名等等。</li></ol><h2 id="网络配置" tabindex="-1">网络配置 <a class="header-anchor" href="#网络配置" aria-label="Permalink to &quot;网络配置&quot;">​</a></h2><ol><li>查看网络是否连通</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">ping</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">www.baidu.com</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">ping</span><span style="color:#24292E;"> </span><span style="color:#032F62;">www.baidu.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>安装 net-tools</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">upgrade</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">net-tools</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">upgrade</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">net-tools</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>配置静态 ip（可选）</li></ol><div class="info custom-block"><p class="custom-block-title">可选</p><p>默认使用 NAT 模式，开启 DHCP，配置静态 ip 主要是防止 ip 地址改变；</p><p><strong>如果不配置静态 ip，也可以直接设置 DHCP 的有效时间为 63 天</strong></p></div><p>修改网络配置文件</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">vi</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/sysconfig/network-scripts/ifcfg-ens33</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">vi</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/sysconfig/network-scripts/ifcfg-ens33</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>修改 <code>BOOTPROTO</code> 为 <code>static</code>，添加 ip 地址、子网掩码、DNS 等设置。</p><blockquote><p>ip 地址参照 4 步骤自行选择（必须在起始和结束的范围内）</p><p>子网掩码默认设置为 255.255.255.0</p><p>网关的值为将 ip 地址中最后一段的值改为 2</p><p>DNS 使用谷歌提供的免费 dns1:8.8.8.8</p></blockquote><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 修改</span></span>
<span class="line"><span style="color:#E1E4E8;">BOOTPROTO</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;static&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">ONBOOT</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;yes&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 添加</span></span>
<span class="line"><span style="color:#E1E4E8;">IPADDR</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.188.128</span></span>
<span class="line"><span style="color:#E1E4E8;">GATEWAY</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.188.2</span></span>
<span class="line"><span style="color:#E1E4E8;">NETMASK</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">255.255</span><span style="color:#9ECBFF;">.255.0</span></span>
<span class="line"><span style="color:#E1E4E8;">DNS1</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">8.8</span><span style="color:#9ECBFF;">.8.8</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 修改</span></span>
<span class="line"><span style="color:#24292E;">BOOTPROTO</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;static&quot;</span></span>
<span class="line"><span style="color:#24292E;">ONBOOT</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;yes&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 添加</span></span>
<span class="line"><span style="color:#24292E;">IPADDR</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.188.128</span></span>
<span class="line"><span style="color:#24292E;">GATEWAY</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.188.2</span></span>
<span class="line"><span style="color:#24292E;">NETMASK</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">255.255</span><span style="color:#032F62;">.255.0</span></span>
<span class="line"><span style="color:#24292E;">DNS1</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">8.8</span><span style="color:#032F62;">.8.8</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>重启网络服务，查看是否配置成功</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">network</span></span>
<span class="line"><span style="color:#B392F0;">ping</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">www.baidu.com</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">network</span></span>
<span class="line"><span style="color:#6F42C1;">ping</span><span style="color:#24292E;"> </span><span style="color:#032F62;">www.baidu.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>重启虚拟机后，查看是否连通网络（ip 地址并未改变，且能连通网络）</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">reboot</span></span>
<span class="line"><span style="color:#B392F0;">ifconfig</span></span>
<span class="line"><span style="color:#B392F0;">ping</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">www.baidu.com</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">reboot</span></span>
<span class="line"><span style="color:#6F42C1;">ifconfig</span></span>
<span class="line"><span style="color:#6F42C1;">ping</span><span style="color:#24292E;"> </span><span style="color:#032F62;">www.baidu.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="克隆虚拟机" tabindex="-1">克隆虚拟机 <a class="header-anchor" href="#克隆虚拟机" aria-label="Permalink to &quot;克隆虚拟机&quot;">​</a></h2><p>使用完整克隆，克隆出两台虚拟机，然后修改主机名。</p><ol><li>修改主机名</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 设置主机名</span></span>
<span class="line"><span style="color:#B392F0;">hostnamectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">set-hostname</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">主机名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看主机名</span></span>
<span class="line"><span style="color:#B392F0;">hostnamectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">主机名</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 设置主机名</span></span>
<span class="line"><span style="color:#6F42C1;">hostnamectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">set-hostname</span><span style="color:#24292E;"> </span><span style="color:#032F62;">主机名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看主机名</span></span>
<span class="line"><span style="color:#6F42C1;">hostnamectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">主机名</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>重启，查看主机名是否修改成功</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 重启</span></span>
<span class="line"><span style="color:#B392F0;">reboot</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看主机名</span></span>
<span class="line"><span style="color:#B392F0;">hostnamectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">主机名</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 重启</span></span>
<span class="line"><span style="color:#6F42C1;">reboot</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看主机名</span></span>
<span class="line"><span style="color:#6F42C1;">hostnamectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">主机名</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>重复上面的 <a href="#网络配置">网络配置</a> 第三步，配置静态 ip。</li></ol><h2 id="配置-ssh-免密登录" tabindex="-1">配置 ssh 免密登录 <a class="header-anchor" href="#配置-ssh-免密登录" aria-label="Permalink to &quot;配置 ssh 免密登录&quot;">​</a></h2><ol><li>在三台机器上面的 hosts 文件中，添加 ip 和主机名的映射。</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 编辑 hosts</span></span>
<span class="line"><span style="color:#B392F0;">vi</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/hosts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 添加映射，根据实际 ip 修改</span></span>
<span class="line"><span style="color:#B392F0;">192.168.188.128</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node1</span></span>
<span class="line"><span style="color:#B392F0;">192.168.188.129</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node2</span></span>
<span class="line"><span style="color:#B392F0;">192.168.188.130</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node3</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 编辑 hosts</span></span>
<span class="line"><span style="color:#6F42C1;">vi</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/hosts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 添加映射，根据实际 ip 修改</span></span>
<span class="line"><span style="color:#6F42C1;">192.168.188.128</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node1</span></span>
<span class="line"><span style="color:#6F42C1;">192.168.188.129</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node2</span></span>
<span class="line"><span style="color:#6F42C1;">192.168.188.130</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>生成密钥文件（四次回车），三台机器都需要生成</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">ssh-keygen</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rsa</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">ssh-keygen</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rsa</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="3"><li>将本机公钥文件复制到其它虚拟机上（接收方需先开机），三台机器都需要将自己的公钥复制到其他机器上。</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 使用 ssh-copy-id 复制到其他机器上，与 hosts 配置对应</span></span>
<span class="line"><span style="color:#6A737D;"># 然后输入 yes 确认，接着输入目标机器的密码</span></span>
<span class="line"><span style="color:#B392F0;">ssh-copy-id</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node1</span></span>
<span class="line"><span style="color:#B392F0;">ssh-copy-id</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node2</span></span>
<span class="line"><span style="color:#B392F0;">ssh-copy-id</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 使用 ssh-copy-id 复制到其他机器上，与 hosts 配置对应</span></span>
<span class="line"><span style="color:#6A737D;"># 然后输入 yes 确认，接着输入目标机器的密码</span></span>
<span class="line"><span style="color:#6F42C1;">ssh-copy-id</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node1</span></span>
<span class="line"><span style="color:#6F42C1;">ssh-copy-id</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node2</span></span>
<span class="line"><span style="color:#6F42C1;">ssh-copy-id</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="4"><li>检查是否配置成功</li></ol><p>在三台机器上面的，分别使用 ssh 命令登录其他节点，无需密码则配置成功。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">ssh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node1</span></span>
<span class="line"><span style="color:#B392F0;">ssh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node2</span></span>
<span class="line"><span style="color:#B392F0;">ssh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node3</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">ssh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node1</span></span>
<span class="line"><span style="color:#6F42C1;">ssh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node2</span></span>
<span class="line"><span style="color:#6F42C1;">ssh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="配置时间同步" tabindex="-1">配置时间同步 <a class="header-anchor" href="#配置时间同步" aria-label="Permalink to &quot;配置时间同步&quot;">​</a></h2><blockquote><p>todo</p></blockquote>`,40),o=[e];function c(r,t,i,d,y,b){return a(),n("div",null,o)}const E=s(p,[["render",c]]);export{u as __pageData,E as default};
