import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.01af844e.js";const b=JSON.parse('{"title":"Mysql 主从部署","description":"","frontmatter":{"title":"Mysql 主从部署","date":"2023-10-17T00:00:00.000Z","order":22},"headers":[],"relativePath":"devops/deploy/mysql-master-slave.md","filePath":"devops/deploy/mysql-master-slave.md","lastUpdated":1730355395000}'),p={name:"devops/deploy/mysql-master-slave.md"},o=l(`<h1 id="mysql-主从部署" tabindex="-1">Mysql 主从部署 <a class="header-anchor" href="#mysql-主从部署" aria-label="Permalink to &quot;Mysql 主从部署&quot;">​</a></h1><h2 id="准备服务器" tabindex="-1">准备服务器 <a class="header-anchor" href="#准备服务器" aria-label="Permalink to &quot;准备服务器&quot;">​</a></h2><p>启动两个 mysql 实例，一台主服务器，一台从服务器</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 创建网络</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">network</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 启动主节点</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-it</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql-master</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--net</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3306</span><span style="color:#9ECBFF;">:3306</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">D:/Docker/mysql-slave/conf:/etc/mysql/conf.d</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">D:/Docker/mysql-slave/data:/var/lib/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">D:/Docker/mysql-slave/logs:/var/log/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MYSQL_ROOT_PASSWORD=root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 启动从节点</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-it</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql-slave</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--net</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">13306</span><span style="color:#9ECBFF;">:3306</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">D:/Docker/mysql-slave/conf:/etc/mysql/conf.d</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">D:/Docker/mysql-slave/data:/var/lib/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">D:/Docker/mysql-slave/logs:/var/log/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MYSQL_ROOT_PASSWORD=root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 创建网络</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">network</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 启动主节点</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-it</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql-master</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--net</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3306</span><span style="color:#032F62;">:3306</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">D:/Docker/mysql-slave/conf:/etc/mysql/conf.d</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">D:/Docker/mysql-slave/data:/var/lib/mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">D:/Docker/mysql-slave/logs:/var/log/mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MYSQL_ROOT_PASSWORD=root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 启动从节点</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-it</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql-slave</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--net</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">13306</span><span style="color:#032F62;">:3306</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">D:/Docker/mysql-slave/conf:/etc/mysql/conf.d</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">D:/Docker/mysql-slave/data:/var/lib/mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">D:/Docker/mysql-slave/logs:/var/log/mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MYSQL_ROOT_PASSWORD=root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="配置主服务器" tabindex="-1">配置主服务器 <a class="header-anchor" href="#配置主服务器" aria-label="Permalink to &quot;配置主服务器&quot;">​</a></h2><p>增加主服务器配置 <code>/etc/mysql/conf.d/my.cnf</code>，然后重启数据库</p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">[mysqld]</span></span>
<span class="line"><span style="color:#F97583;">server-id</span><span style="color:#E1E4E8;"> = 1        </span><span style="color:#6A737D;"># 节点 ID，确保唯一</span></span>
<span class="line"><span style="color:#6A737D;"># log config</span></span>
<span class="line"><span style="color:#F97583;">log-bin</span><span style="color:#E1E4E8;"> = mysql-bin     </span><span style="color:#6A737D;">#开启 mysql 的 binlog 日志功能，binlog 日志位置</span></span>
<span class="line"><span style="color:#F97583;">sync_binlog</span><span style="color:#E1E4E8;"> = 1         </span><span style="color:#6A737D;">#控制数据库的 binlog 刷到磁盘上去 , 0 不控制，性能最好，1 每次事物提交都会刷到日志文件中，性能最差，最安全</span></span>
<span class="line"><span style="color:#F97583;">binlog_format</span><span style="color:#E1E4E8;"> = mixed   </span><span style="color:#6A737D;">#binlog 日志格式，mysql 默认采用 statement，建议使用 mixed</span></span>
<span class="line"><span style="color:#F97583;">expire_logs_days</span><span style="color:#E1E4E8;"> = 7                           </span><span style="color:#6A737D;">#binlog 过期清理时间</span></span>
<span class="line"><span style="color:#F97583;">max_binlog_size</span><span style="color:#E1E4E8;"> = 100m                    </span><span style="color:#6A737D;">#binlog 每个日志文件大小</span></span>
<span class="line"><span style="color:#F97583;">binlog_cache_size</span><span style="color:#E1E4E8;"> = 4m                        </span><span style="color:#6A737D;">#binlog 缓存大小</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">binlog-do-db</span><span style="color:#E1E4E8;">=daydayup </span><span style="color:#6A737D;">#需要同步的数据库</span></span>
<span class="line"><span style="color:#F97583;">max_binlog_cache_size</span><span style="color:#E1E4E8;">= 512m              </span><span style="color:#6A737D;">#最大 binlog 缓存大</span></span>
<span class="line"><span style="color:#F97583;">binlog-ignore-db</span><span style="color:#E1E4E8;">=mysql </span><span style="color:#6A737D;">#不生成日志文件的数据库，多个忽略数据库可以用逗号拼接，或者复制这句话，写多行</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">auto-increment-offset</span><span style="color:#E1E4E8;"> = 1     </span><span style="color:#6A737D;"># 自增值的偏移量</span></span>
<span class="line"><span style="color:#F97583;">auto-increment-increment</span><span style="color:#E1E4E8;"> = 1  </span><span style="color:#6A737D;"># 自增值的自增量</span></span>
<span class="line"><span style="color:#F97583;">replica_skip_errors</span><span style="color:#E1E4E8;"> = all </span><span style="color:#6A737D;">#跳过从库错误</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">[mysqld]</span></span>
<span class="line"><span style="color:#D73A49;">server-id</span><span style="color:#24292E;"> = 1        </span><span style="color:#6A737D;"># 节点 ID，确保唯一</span></span>
<span class="line"><span style="color:#6A737D;"># log config</span></span>
<span class="line"><span style="color:#D73A49;">log-bin</span><span style="color:#24292E;"> = mysql-bin     </span><span style="color:#6A737D;">#开启 mysql 的 binlog 日志功能，binlog 日志位置</span></span>
<span class="line"><span style="color:#D73A49;">sync_binlog</span><span style="color:#24292E;"> = 1         </span><span style="color:#6A737D;">#控制数据库的 binlog 刷到磁盘上去 , 0 不控制，性能最好，1 每次事物提交都会刷到日志文件中，性能最差，最安全</span></span>
<span class="line"><span style="color:#D73A49;">binlog_format</span><span style="color:#24292E;"> = mixed   </span><span style="color:#6A737D;">#binlog 日志格式，mysql 默认采用 statement，建议使用 mixed</span></span>
<span class="line"><span style="color:#D73A49;">expire_logs_days</span><span style="color:#24292E;"> = 7                           </span><span style="color:#6A737D;">#binlog 过期清理时间</span></span>
<span class="line"><span style="color:#D73A49;">max_binlog_size</span><span style="color:#24292E;"> = 100m                    </span><span style="color:#6A737D;">#binlog 每个日志文件大小</span></span>
<span class="line"><span style="color:#D73A49;">binlog_cache_size</span><span style="color:#24292E;"> = 4m                        </span><span style="color:#6A737D;">#binlog 缓存大小</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">binlog-do-db</span><span style="color:#24292E;">=daydayup </span><span style="color:#6A737D;">#需要同步的数据库</span></span>
<span class="line"><span style="color:#D73A49;">max_binlog_cache_size</span><span style="color:#24292E;">= 512m              </span><span style="color:#6A737D;">#最大 binlog 缓存大</span></span>
<span class="line"><span style="color:#D73A49;">binlog-ignore-db</span><span style="color:#24292E;">=mysql </span><span style="color:#6A737D;">#不生成日志文件的数据库，多个忽略数据库可以用逗号拼接，或者复制这句话，写多行</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">auto-increment-offset</span><span style="color:#24292E;"> = 1     </span><span style="color:#6A737D;"># 自增值的偏移量</span></span>
<span class="line"><span style="color:#D73A49;">auto-increment-increment</span><span style="color:#24292E;"> = 1  </span><span style="color:#6A737D;"># 自增值的自增量</span></span>
<span class="line"><span style="color:#D73A49;">replica_skip_errors</span><span style="color:#24292E;"> = all </span><span style="color:#6A737D;">#跳过从库错误</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="配置从服务器" tabindex="-1">配置从服务器 <a class="header-anchor" href="#配置从服务器" aria-label="Permalink to &quot;配置从服务器&quot;">​</a></h2><p>增加从服务器配置 <code>/etc/mysql/conf.d/my.cnf</code>，然后重启数据库</p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">[mysqld]</span></span>
<span class="line"><span style="color:#F97583;">server-id</span><span style="color:#E1E4E8;">=2</span></span>
<span class="line"><span style="color:#F97583;">log-bin</span><span style="color:#E1E4E8;">=mysql-bin </span><span style="color:#6A737D;"># 如果从数据库，不需要再往其他数据库同步，可以注释掉</span></span>
<span class="line"><span style="color:#F97583;">relay-log</span><span style="color:#E1E4E8;">=slave-relay-bin </span><span style="color:#6A737D;"># 必须开启，从主数据库同步的 binlog 会写入到该目录下</span></span>
<span class="line"><span style="color:#F97583;">relay-log-index</span><span style="color:#E1E4E8;">=slave-relay-bin</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">[mysqld]</span></span>
<span class="line"><span style="color:#D73A49;">server-id</span><span style="color:#24292E;">=2</span></span>
<span class="line"><span style="color:#D73A49;">log-bin</span><span style="color:#24292E;">=mysql-bin </span><span style="color:#6A737D;"># 如果从数据库，不需要再往其他数据库同步，可以注释掉</span></span>
<span class="line"><span style="color:#D73A49;">relay-log</span><span style="color:#24292E;">=slave-relay-bin </span><span style="color:#6A737D;"># 必须开启，从主数据库同步的 binlog 会写入到该目录下</span></span>
<span class="line"><span style="color:#D73A49;">relay-log-index</span><span style="color:#24292E;">=slave-relay-bin</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="创建同步专用用户" tabindex="-1">创建同步专用用户 <a class="header-anchor" href="#创建同步专用用户" aria-label="Permalink to &quot;创建同步专用用户&quot;">​</a></h2><p>（可选）在主服务器创建一个用户，专门用来同步数据</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">#如果使用navicate创建用户，需要修改加密方式</span></span>
<span class="line"><span style="color:#F97583;">alter</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">user</span><span style="color:#E1E4E8;"> xxx identified </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> mysql_native_password </span><span style="color:#F97583;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;password&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">#修改host改为所有ip</span></span>
<span class="line"><span style="color:#F97583;">update</span><span style="color:#E1E4E8;"> user </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> host</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;%&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> user</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;xxx&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">#授权不需要加密码</span></span>
<span class="line"><span style="color:#F97583;">grant</span><span style="color:#E1E4E8;"> replication SLAVE </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;xxx&#39;</span><span style="color:#E1E4E8;">@</span><span style="color:#9ECBFF;">&#39;%&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">#如果使用navicate创建用户，需要修改加密方式</span></span>
<span class="line"><span style="color:#D73A49;">alter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">user</span><span style="color:#24292E;"> xxx identified </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> mysql_native_password </span><span style="color:#D73A49;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;password&#39;</span></span>
<span class="line"><span style="color:#24292E;">#修改host改为所有ip</span></span>
<span class="line"><span style="color:#D73A49;">update</span><span style="color:#24292E;"> user </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> host</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;%&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> user</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;xxx&#39;</span></span>
<span class="line"><span style="color:#24292E;">#授权不需要加密码</span></span>
<span class="line"><span style="color:#D73A49;">grant</span><span style="color:#24292E;"> replication SLAVE </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;xxx&#39;</span><span style="color:#24292E;">@</span><span style="color:#032F62;">&#39;%&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="检查主服务器状态" tabindex="-1">检查主服务器状态 <a class="header-anchor" href="#检查主服务器状态" aria-label="Permalink to &quot;检查主服务器状态&quot;">​</a></h2><p>登录主服务器，查看主服务器 master 状态</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">show </span><span style="color:#F97583;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">status</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">master</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">status</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>记录下 <code>file</code> 和 <code>position</code> 属性</p><h2 id="检查从服务器状态" tabindex="-1">检查从服务器状态 <a class="header-anchor" href="#检查从服务器状态" aria-label="Permalink to &quot;检查从服务器状态&quot;">​</a></h2><p>登录从服务器，设置 slave 信息</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"># 先停止 slave 服务</span></span>
<span class="line"><span style="color:#F97583;">stop</span><span style="color:#E1E4E8;"> slave;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;"># 设置 </span><span style="color:#F97583;">master</span><span style="color:#E1E4E8;"> 同步信息，修改信息为实际信息，后两项为上面从主服务器获取的 </span><span style="color:#9ECBFF;">\`file\`</span><span style="color:#E1E4E8;"> 和 </span><span style="color:#9ECBFF;">\`position\`</span><span style="color:#E1E4E8;"> 属性</span></span>
<span class="line"><span style="color:#E1E4E8;">change </span><span style="color:#F97583;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> master_host</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;172.18.0.2&#39;</span><span style="color:#E1E4E8;">, master_port</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3306</span><span style="color:#E1E4E8;">,master_user</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;root&#39;</span><span style="color:#E1E4E8;">, master_password</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;root&#39;</span><span style="color:#E1E4E8;">,master_log_file</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;mysql-bin.000004&#39;</span><span style="color:#E1E4E8;">,master_log_pos</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">5018</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;"># 启动 slave 服务</span></span>
<span class="line"><span style="color:#F97583;">start</span><span style="color:#E1E4E8;"> slave;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;"># 查看 slave 状态，观察到如下图所示启动成功</span></span>
<span class="line"><span style="color:#E1E4E8;">show slave </span><span style="color:#F97583;">status</span><span style="color:#E1E4E8;"> \\G;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"># 先停止 slave 服务</span></span>
<span class="line"><span style="color:#D73A49;">stop</span><span style="color:#24292E;"> slave;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"># 设置 </span><span style="color:#D73A49;">master</span><span style="color:#24292E;"> 同步信息，修改信息为实际信息，后两项为上面从主服务器获取的 </span><span style="color:#032F62;">\`file\`</span><span style="color:#24292E;"> 和 </span><span style="color:#032F62;">\`position\`</span><span style="color:#24292E;"> 属性</span></span>
<span class="line"><span style="color:#24292E;">change </span><span style="color:#D73A49;">master</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> master_host</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;172.18.0.2&#39;</span><span style="color:#24292E;">, master_port</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3306</span><span style="color:#24292E;">,master_user</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;root&#39;</span><span style="color:#24292E;">, master_password</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;root&#39;</span><span style="color:#24292E;">,master_log_file</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;mysql-bin.000004&#39;</span><span style="color:#24292E;">,master_log_pos</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">5018</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"># 启动 slave 服务</span></span>
<span class="line"><span style="color:#D73A49;">start</span><span style="color:#24292E;"> slave;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"># 查看 slave 状态，观察到如下图所示启动成功</span></span>
<span class="line"><span style="color:#24292E;">show slave </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> \\G;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/AlexChen68/OSS@master/images/2023/1686762625238.png" alt=""></p><h2 id="检验是否同步" tabindex="-1">检验是否同步 <a class="header-anchor" href="#检验是否同步" aria-label="Permalink to &quot;检验是否同步&quot;">​</a></h2><p>在主服务器增加数据，自动同步数据到从数据库相应数据库即设置成功（同步哪些数据库由上述的配置文件设定）</p>`,23),e=[o];function r(c,t,y,i,E,d){return a(),n("div",null,e)}const F=s(p,[["render",r]]);export{b as __pageData,F as default};
