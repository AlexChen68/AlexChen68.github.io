import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.01af844e.js";const u=JSON.parse('{"title":"分布式事务中间件 Seata","description":"","frontmatter":{"title":"分布式事务中间件 Seata","date":"2023-06-13T00:00:00.000Z","order":5},"headers":[],"relativePath":"architecture/distributed/seata.md","filePath":"architecture/distributed/seata.md","lastUpdated":1713403090000}'),p={name:"architecture/distributed/seata.md"},o=l(`<h1 id="分布式事务中间件-seata" tabindex="-1">分布式事务中间件 Seata <a class="header-anchor" href="#分布式事务中间件-seata" aria-label="Permalink to &quot;分布式事务中间件 Seata&quot;">​</a></h1><blockquote><p>本文使用的 seata 版本：1.5.2</p></blockquote><h2 id="什么是分布式事务" tabindex="-1">什么是分布式事务？ <a class="header-anchor" href="#什么是分布式事务" aria-label="Permalink to &quot;什么是分布式事务？&quot;">​</a></h2><p>事务是一个程序执行单元，里面的所有操作要么全部执行成功，要么全部执行失败。在分布式系统中，这些操作可能是位于不同的服务中，那么如果也能保证这些操作要么全部执行成功要么全部执行失败呢？这便是分布式事务要解决的问题。</p><h2 id="seata-简介" tabindex="-1">Seata 简介 <a class="header-anchor" href="#seata-简介" aria-label="Permalink to &quot;Seata 简介&quot;">​</a></h2><p>Seata 是一款开源的分布式事务解决方案，致力于在微服务架构下提供高性能和简单易用的分布式事务服务。</p><p>Seata 为用户提供了 <code>AT</code>、<code>TCC</code>、<code>SAGA</code> 和 <code>XA</code> 四种事务模式，打造一站式的分布式解决方案。</p><ul><li><a href="https://seata.io/zh-cn/index.html" target="_blank" rel="noreferrer">Seata 官网链接</a></li></ul><h2 id="seata-入门" tabindex="-1">seata 入门 <a class="header-anchor" href="#seata-入门" aria-label="Permalink to &quot;seata 入门&quot;">​</a></h2><h3 id="启动-seata-server" tabindex="-1">启动 seata server <a class="header-anchor" href="#启动-seata-server" aria-label="Permalink to &quot;启动 seata server&quot;">​</a></h3><p>Server 端存储模式（store.mode）现有 file、db、redis 三种（后续将引入 raft,mongodb），file 模式无需改动，直接启动即可，下面专门讲下 db 和 redis 启动步骤。</p><div class="warning custom-block"><p class="custom-block-title">注：</p><ul><li>file 模式为单机模式，全局事务会话信息内存中读写并持久化本地文件 root.data，性能较高（默认）。</li><li>db 模式为高可用模式，全局事务会话信息通过 db 共享，相应性能差些。</li><li>redis 模式 Seata-Server 1.3 及以上版本支持，性能较高，存在事务信息丢失风险，请提前配置合适当前场景的 redis 持久化配置。</li></ul></div><div class="danger custom-block"><p class="custom-block-title">重要‼️</p><p><strong>本文主要介绍使用 Nacos 作为数据中心和配置中心启动 seata server，采用 db 模式启动的方式。</strong></p></div><h4 id="下载-seata-server" tabindex="-1">下载 seata-server <a class="header-anchor" href="#下载-seata-server" aria-label="Permalink to &quot;下载 seata-server&quot;">​</a></h4><p>从 <a href="https://github.com/seata/seata/releases" target="_blank" rel="noreferrer">seata-release</a> 下载需要的版本压缩包解压。</p><p>示例：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/seata/seata/releases/download/v1.5.2/seata-server-1.5.2.zip</span></span>
<span class="line"><span style="color:#B392F0;">unzip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">seata-server-1.5.2.zip</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/seata/seata/releases/download/v1.5.2/seata-server-1.5.2.zip</span></span>
<span class="line"><span style="color:#6F42C1;">unzip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">seata-server-1.5.2.zip</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>解压后目录如下所示：</p><p><img src="https://cdn.jsdelivr.net/gh/AlexChen68/OSS@master/images/2023/20231111091001.png" alt="20231111091001"></p><h4 id="配置-seata-server" tabindex="-1">配置 seata-server <a class="header-anchor" href="#配置-seata-server" aria-label="Permalink to &quot;配置 seata-server&quot;">​</a></h4><p>seata-server 可以向注册中心注册，也可以将其配置参数存储到配置中心中。</p><ul><li>注册中心类型可选范围为：file、nacos、eureka、redis、zk、consul、etcd3、sofa，通常选择 nacos 配置中心作为注册中心；</li><li>配置中心类型可选择范围为：file、nacos、apollo、zk、consul、etcd3。</li></ul><p>打开 seata-server 的目录，进入 <code>conf</code> 目录，可以通过修改 <code>application.yml</code> 配置文件来改变 seata-server 的注册和配置方式。</p><p>配置参数说明：</p><ul><li><code>seata.registry</code>：注册中心的类型及其对应的配置参数;</li><li><code>seata.config</code>：配置中心的类型及其对应的配置参数;</li><li><code>seata.store.mode</code>：事务管理过程中的相关信息的存储方式，存储模式有三种：<code>file</code>、<code>db</code>、<code>redis</code>。 <ul><li>若选择为 store.mode=file，Seata 的事务相关信息会存储在内存中，并持久化到本地 root.data 文件中，性能比较高。</li><li>若选择为 store.mode=db。Seata 的事务相关信息会存储在数据库中。使用数据库模式可以支持多个 seata-server 启动，实现 seata-server 高可用。</li></ul></li></ul><p>如果你都使用 file，那么你直接就可以启动它了，但通常我们会使用 nacos + db 的方式部署，这样可以实现高可用。</p><p>这里我们使用 nacos + db 的方式进行配置，<code>application.yml</code> 示例配置：</p><div class="language-yml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">server</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">7091</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">spring</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">application</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">seata-server</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">logging</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">config</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">classpath:logback-spring.xml</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">file</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${user.home}/logs/seata</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">extend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">logstash-appender</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">destination</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">127.0.0.1:4560</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">kafka-appender</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">bootstrap-servers</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">127.0.0.1:9092</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">topic</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">logback_to_logstash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">console</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">user</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">seata</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">seata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">seata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">config</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># support: nacos, consul, apollo, zk, etcd3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nacos</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">nacos</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">server-addr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">127.0.0.1:8848</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">:              </span><span style="color:#6A737D;">#此处不填写，将会默认使用 DEFAULT_GROUP</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">group</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">SEATA_GROUP</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nacos</span><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">#nacos 的账户（请自行修改）</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nacos</span><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">#nacos 的密码（请自行修改）</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">data-id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">seata-server.yml</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#对应文章后边在 nacos 中添加的配置</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">registry</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nacos</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">nacos</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">application</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">seata-server</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">server-addr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">127.0.0.1:8848</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">group</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">SEATA_GROUP</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">:              </span><span style="color:#6A737D;">#此处不填写，将会默认使用 DEFAULT_GROUP</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">cluster</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nacos</span><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">#nacos 的账户（请自行修改）</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nacos</span><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">#nacos 的密码（请自行修改）</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># store:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># support: file 、 db 、 redis</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># mode: file</span></span>
<span class="line"><span style="color:#6A737D;">#  server:</span></span>
<span class="line"><span style="color:#6A737D;">#    service-port: 8091 #If not configured, the default is &#39;\${server.port} + 1000&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">security</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">secretKey</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">SeataSecretKey0c382ef121d778043159209298fd40bf3850a017</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">tokenValidityInMilliseconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1800000</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ignore</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">urls</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/api/v1/auth/login</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">server</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">7091</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">application</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">seata-server</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">logging</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">config</span><span style="color:#24292E;">: </span><span style="color:#032F62;">classpath:logback-spring.xml</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">file</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${user.home}/logs/seata</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">extend</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">logstash-appender</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">destination</span><span style="color:#24292E;">: </span><span style="color:#032F62;">127.0.0.1:4560</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">kafka-appender</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">bootstrap-servers</span><span style="color:#24292E;">: </span><span style="color:#032F62;">127.0.0.1:9092</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">topic</span><span style="color:#24292E;">: </span><span style="color:#032F62;">logback_to_logstash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">console</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">user</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">seata</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">seata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">seata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">config</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># support: nacos, consul, apollo, zk, etcd3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nacos</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">nacos</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">server-addr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">127.0.0.1:8848</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">:              </span><span style="color:#6A737D;">#此处不填写，将会默认使用 DEFAULT_GROUP</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">group</span><span style="color:#24292E;">: </span><span style="color:#032F62;">SEATA_GROUP</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nacos</span><span style="color:#24292E;">         </span><span style="color:#6A737D;">#nacos 的账户（请自行修改）</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nacos</span><span style="color:#24292E;">         </span><span style="color:#6A737D;">#nacos 的密码（请自行修改）</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">data-id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">seata-server.yml</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#对应文章后边在 nacos 中添加的配置</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">registry</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nacos</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">nacos</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">application</span><span style="color:#24292E;">: </span><span style="color:#032F62;">seata-server</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">server-addr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">127.0.0.1:8848</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">group</span><span style="color:#24292E;">: </span><span style="color:#032F62;">SEATA_GROUP</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">:              </span><span style="color:#6A737D;">#此处不填写，将会默认使用 DEFAULT_GROUP</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">cluster</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nacos</span><span style="color:#24292E;">         </span><span style="color:#6A737D;">#nacos 的账户（请自行修改）</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nacos</span><span style="color:#24292E;">         </span><span style="color:#6A737D;">#nacos 的密码（请自行修改）</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># store:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># support: file 、 db 、 redis</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># mode: file</span></span>
<span class="line"><span style="color:#6A737D;">#  server:</span></span>
<span class="line"><span style="color:#6A737D;">#    service-port: 8091 #If not configured, the default is &#39;\${server.port} + 1000&#39;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">security</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">secretKey</span><span style="color:#24292E;">: </span><span style="color:#032F62;">SeataSecretKey0c382ef121d778043159209298fd40bf3850a017</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">tokenValidityInMilliseconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1800000</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ignore</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">urls</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/api/v1/auth/login</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><div class="warning custom-block"><p class="custom-block-title">注意：</p><p>上面的配置中，config 配置类型为 nacos，即 seata-server 的配置存储在了 nacos 名为 <code>seata-server.yml</code> 的配置中，因此注释掉了 <code>seata.store</code> 配置，选择在 nacos 的配置中配置存储方式。</p></div><p>配置完成后，后面还需要启动 nacos，在 nacos 中添加 <code>seata-server.yml</code> 的配置。</p><h4 id="初始化数据库表结构" tabindex="-1">初始化数据库表结构 <a class="header-anchor" href="#初始化数据库表结构" aria-label="Permalink to &quot;初始化数据库表结构&quot;">​</a></h4><p>当 <code>seata.store</code> 的配置为 <code>db</code> 时，需要配置数据库连接信息，并且初始化数据表。</p><p>初始化数据表操作可以从安装目录的 <code>/script/server/db</code> 子目录下，获取对应数据库类型的 sql 文件，在数据库执行来初始化 seata-server 运行时需要的数据表。</p><h4 id="集成-nacos-配置中心" tabindex="-1">集成 Nacos 配置中心 <a class="header-anchor" href="#集成-nacos-配置中心" aria-label="Permalink to &quot;集成 Nacos 配置中心&quot;">​</a></h4><p>Nacos 新增配置文件 <code>seata-server.yml</code>，seata-server 的配置参数可以参考 <a href="http://seata.io/zh-cn/docs/user/configurations" target="_blank" rel="noreferrer">官方文档-seata 参数配置</a>，也可以从 seata-server 目录下 <code>/script/config-center/config.txt</code> 文件中选取需要的配置（config.txt 包含了 server 和 client 的全部配置，适当选择配置）。</p><p><code>seata-server.yml</code> 示例配置：</p><div class="language-yml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">vgroupMapping</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">zeus-tx-group</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">store</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">mode</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">db</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">db</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">datasource</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">druid</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">dbType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">driverClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">com.mysql.jdbc.Driver</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">url</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">jdbc:mysql://zeus-mysql:3306/seata_server?useUnicode=true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">user</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">root</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">root</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">minConn</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">maxConn</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">30</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">globalTable</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">global_table</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">branchTable</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">branch_table</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">distributedLockTable</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">distributed_lock</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">queryLimit</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">100</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">lockTable</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">lock_table</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">maxWait</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5000</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">vgroupMapping</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">zeus-tx-group</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">store</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">mode</span><span style="color:#24292E;">: </span><span style="color:#032F62;">db</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">db</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">datasource</span><span style="color:#24292E;">: </span><span style="color:#032F62;">druid</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">dbType</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">driverClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">com.mysql.jdbc.Driver</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">url</span><span style="color:#24292E;">: </span><span style="color:#032F62;">jdbc:mysql://zeus-mysql:3306/seata_server?useUnicode=true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">user</span><span style="color:#24292E;">: </span><span style="color:#032F62;">root</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">root</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">minConn</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">maxConn</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">30</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">globalTable</span><span style="color:#24292E;">: </span><span style="color:#032F62;">global_table</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">branchTable</span><span style="color:#24292E;">: </span><span style="color:#032F62;">branch_table</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">distributedLockTable</span><span style="color:#24292E;">: </span><span style="color:#032F62;">distributed_lock</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">queryLimit</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">100</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">lockTable</span><span style="color:#24292E;">: </span><span style="color:#032F62;">lock_table</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">maxWait</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">说明：</p><p><code>service.vgroupMapping</code> 为事务分组配置，<code>zeus-tx-group</code> 为自定义的事务组名称，<code>default</code> 为 nacos 集群，与 seata-server 的 配置相对应。</p></div><p><img src="https://cdn.jsdelivr.net/gh/AlexChen68/OSS@master/images/2023/seata-2023-11-11-09-59-05.png" alt="seata-2023-11-11-09-59-05"></p><h4 id="启动-server" tabindex="-1">启动 Server <a class="header-anchor" href="#启动-server" aria-label="Permalink to &quot;启动 Server&quot;">​</a></h4><p>首先进入 seata-server 目录下的 <code>bin</code> 目录，然后调用 <code>seata-server.sh</code> 启动 server：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">./seata-server.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8091</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">./seata-server.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8091</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>各启动参数含义：</p><blockquote><p>-h: 注册到注册中心的 ip</p><p>-p: Server rpc 监听端口</p><p>-m: 全局事务会话信息存储模式，file、db、redis，<strong>优先读取启动参数</strong> (Seata-Server 1.3 及以上版本支持 redis)</p><p>-n: Server node，当有多个 Server 时，需区分各自节点，用于生成不同区间的 transactionId，以免冲突</p><p>-e: 多环境配置参考 <a href="http://seata.io/en-us/docs/ops/multi-configuration-isolation.html" target="_blank" rel="noreferrer">http://seata.io/en-us/docs/ops/multi-configuration-isolation.html</a></p></blockquote><p>查看 nacos 的服务列表，是否成功注册到 nacos。</p><p><img src="https://cdn.jsdelivr.net/gh/AlexChen68/OSS@master/images/2023/nacos-seata-server.png" alt="nacos-seata-server"></p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>注意：seata 启动会占用两个端口，8091 和 7091。其中 8091 是注册到 nacos 中的服务端端口，7091 是其客户端端口，如下图所示。</p></div><p><img src="https://cdn.jsdelivr.net/gh/AlexChen68/OSS@master/images/2023/seata-2023-11-11-10-11-13.png" alt="seata-2023-11-11-10-11-13"></p><h3 id="集成-seata-client" tabindex="-1">集成 seata client <a class="header-anchor" href="#集成-seata-client" aria-label="Permalink to &quot;集成 seata client&quot;">​</a></h3><h4 id="引入依赖" tabindex="-1">引入依赖 <a class="header-anchor" href="#引入依赖" aria-label="Permalink to &quot;引入依赖&quot;">​</a></h4><p>SpringBoot 使用：</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;io.seata&lt;/</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;seata-spring-boot-starter&lt;/</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;</span><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">&gt;1.5.2&lt;/</span><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">   &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;io.seata&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">   &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;seata-spring-boot-starter&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">   &lt;</span><span style="color:#22863A;">version</span><span style="color:#24292E;">&gt;1.5.2&lt;/</span><span style="color:#22863A;">version</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>SpringCloud 使用：</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;com.alibaba.cloud&lt;/</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;spring-cloud-starter-alibaba-seata&lt;/</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">   &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;com.alibaba.cloud&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">   &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;spring-cloud-starter-alibaba-seata&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="业务数据库添加-undo-log-表" tabindex="-1">业务数据库添加 undo_log 表 <a class="header-anchor" href="#业务数据库添加-undo-log-表" aria-label="Permalink to &quot;业务数据库添加 undo_log 表&quot;">​</a></h4><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">-- for AT mode you must to init this sql for you business database. the seata server not need it.</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IF</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">NOT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">EXISTS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`undo_log\`</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">\`branch_id\`</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">BIGINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">NOT NULL</span><span style="color:#E1E4E8;"> COMMENT </span><span style="color:#9ECBFF;">&#39;branch transaction id&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">\`xid\`</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">128</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">NOT NULL</span><span style="color:#E1E4E8;"> COMMENT </span><span style="color:#9ECBFF;">&#39;global transaction id&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">\`context\`</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">128</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">NOT NULL</span><span style="color:#E1E4E8;"> COMMENT </span><span style="color:#9ECBFF;">&#39;undo_log context,such as serialization&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">\`rollback_info\`</span><span style="color:#E1E4E8;"> LONGBLOB     </span><span style="color:#F97583;">NOT NULL</span><span style="color:#E1E4E8;"> COMMENT </span><span style="color:#9ECBFF;">&#39;rollback info&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">\`log_status\`</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">INT</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;">)      </span><span style="color:#F97583;">NOT NULL</span><span style="color:#E1E4E8;"> COMMENT </span><span style="color:#9ECBFF;">&#39;0:normal status,1:defense status&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">\`log_created\`</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">DATETIME</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">)  </span><span style="color:#F97583;">NOT NULL</span><span style="color:#E1E4E8;"> COMMENT </span><span style="color:#9ECBFF;">&#39;create datetime&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">\`log_modified\`</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">DATETIME</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">)  </span><span style="color:#F97583;">NOT NULL</span><span style="color:#E1E4E8;"> COMMENT </span><span style="color:#9ECBFF;">&#39;modify datetime&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">UNIQUE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">KEY</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`ux_undo_log\`</span><span style="color:#E1E4E8;"> (</span><span style="color:#9ECBFF;">\`xid\`</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">\`branch_id\`</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">) ENGINE </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> InnoDB</span></span>
<span class="line"><span style="color:#E1E4E8;">  AUTO_INCREMENT </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">DEFAULT</span><span style="color:#E1E4E8;"> CHARSET </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> utf8 COMMENT </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;AT transaction mode undo table&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- for AT mode you must to init this sql for you business database. the seata server not need it.</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IF</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">NOT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">EXISTS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`undo_log\`</span></span>
<span class="line"><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">\`branch_id\`</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">BIGINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;"> COMMENT </span><span style="color:#032F62;">&#39;branch transaction id&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">\`xid\`</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">VARCHAR</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">128</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;"> COMMENT </span><span style="color:#032F62;">&#39;global transaction id&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">\`context\`</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">VARCHAR</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">128</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;"> COMMENT </span><span style="color:#032F62;">&#39;undo_log context,such as serialization&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">\`rollback_info\`</span><span style="color:#24292E;"> LONGBLOB     </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;"> COMMENT </span><span style="color:#032F62;">&#39;rollback info&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">\`log_status\`</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">INT</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">11</span><span style="color:#24292E;">)      </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;"> COMMENT </span><span style="color:#032F62;">&#39;0:normal status,1:defense status&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">\`log_created\`</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">DATETIME</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">6</span><span style="color:#24292E;">)  </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;"> COMMENT </span><span style="color:#032F62;">&#39;create datetime&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">\`log_modified\`</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">DATETIME</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">6</span><span style="color:#24292E;">)  </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;"> COMMENT </span><span style="color:#032F62;">&#39;modify datetime&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">UNIQUE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">KEY</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`ux_undo_log\`</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">\`xid\`</span><span style="color:#24292E;">, </span><span style="color:#032F62;">\`branch_id\`</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">) ENGINE </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> InnoDB</span></span>
<span class="line"><span style="color:#24292E;">  AUTO_INCREMENT </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">DEFAULT</span><span style="color:#24292E;"> CHARSET </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> utf8 COMMENT </span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;AT transaction mode undo table&#39;</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="客户端-增加-seata-配置" tabindex="-1">客户端 增加 seata 配置 <a class="header-anchor" href="#客户端-增加-seata-配置" aria-label="Permalink to &quot;客户端 增加 seata 配置&quot;">​</a></h4><div class="language-yml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">seata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">tx-service-group</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">zeus_tx_group</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">vgroupMapping</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">zeus_tx_group</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">registry</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nacos</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">nacos</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">application</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">seata-server</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">server-addr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">zeus-nacos:8848</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">group</span><span style="color:#E1E4E8;"> : </span><span style="color:#9ECBFF;">&quot;SEATA_GROUP&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#85E89D;">spring</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">datasource</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">driver-class-name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">com.mysql.cj.jdbc.Driver</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${MYSQL_USER:root}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${MYSQL_PWD:root}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">url</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">jdbc:mysql://\${MYSQL_HOST:127.0.0.1}:\${MYSQL_PORT:3306}/\${MYSQL_DB:seata_order}?characterEncoding=utf8&amp;serverTimezone=GMT%2B8&amp;zeroDateTimeBehavior=convertToNull</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">seata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">tx-service-group</span><span style="color:#24292E;">: </span><span style="color:#032F62;">zeus_tx_group</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">vgroupMapping</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">zeus_tx_group</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">registry</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nacos</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">nacos</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">application</span><span style="color:#24292E;">: </span><span style="color:#032F62;">seata-server</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">server-addr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">zeus-nacos:8848</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">group</span><span style="color:#24292E;"> : </span><span style="color:#032F62;">&quot;SEATA_GROUP&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">datasource</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">driver-class-name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">com.mysql.cj.jdbc.Driver</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${MYSQL_USER:root}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${MYSQL_PWD:root}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">url</span><span style="color:#24292E;">: </span><span style="color:#032F62;">jdbc:mysql://\${MYSQL_HOST:127.0.0.1}:\${MYSQL_PORT:3306}/\${MYSQL_DB:seata_order}?characterEncoding=utf8&amp;serverTimezone=GMT%2B8&amp;zeroDateTimeBehavior=convertToNull</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="使用全局事务" tabindex="-1">使用全局事务 <a class="header-anchor" href="#使用全局事务" aria-label="Permalink to &quot;使用全局事务&quot;">​</a></h4><p>在主服务中，第一个开启事务的需要添加 seata 全局事务注解</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">GlobalTransactional</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">rollbackFor</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Exception.class)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">GlobalTransactional</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">rollbackFor</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Exception.class)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><ul><li><a href="https://seata.io/zh-cn/docs/v1.5/ops/deploy-guide-beginner" target="_blank" rel="noreferrer">Seata 官方手册</a></li><li><a href="https://blog.csdn.net/yyongsheng/article/details/131248364" target="_blank" rel="noreferrer">若依微服务 + seata1.5.2 版本分布式事务（安装配置 nacos+ 部署）</a></li></ul>`,63),e=[o];function r(c,t,E,y,i,d){return a(),n("div",null,e)}const m=s(p,[["render",r]]);export{u as __pageData,m as default};
