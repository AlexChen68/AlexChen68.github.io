import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.419948d5.js";const b=JSON.parse('{"title":"Alibaba Nacos - 注册中心","description":"注册中心","frontmatter":{"title":"Alibaba Nacos - 注册中心","date":"2023-02-12T00:00:00.000Z","description":"注册中心"},"headers":[],"relativePath":"spring/springcloud/1.1-register.md","filePath":"spring/springcloud/1.1-register.md","lastUpdated":1697497069000}'),o={name:"spring/springcloud/1.1-register.md"},p=l(`<h2 id="什么是注册中心" tabindex="-1">什么是注册中心？ <a class="header-anchor" href="#什么是注册中心" aria-label="Permalink to &quot;什么是注册中心？&quot;">​</a></h2><p>注册中心的概念：</p><ul><li>注册中心是微服务架构中最基础也是最重要的组件</li><li>注册中心本质上是为了解耦微服务</li><li>注册中心主要用于提供服务的发现与注册</li><li>注册中心相当于微服务之间的通讯录，记录着所有微服务的地址</li><li>注册中心能实现微服务之间的相互调用</li></ul><p><strong>常见的注册中心组件</strong>：</p><p>常见的注册中心组件有 Eureka、Consul、Nacos、Zookeeper，前三者属于 springcloud 体系，最后一个属于 Dubbo 类体系，两种体系代表两种注册中心实现方案，虽然是不同的方案，但是最终实现的效果相同。</p><p>本文仅介绍 Nacos 的使用。</p><h2 id="alibaba-nacos-组件" tabindex="-1">Alibaba Nacos 组件 <a class="header-anchor" href="#alibaba-nacos-组件" aria-label="Permalink to &quot;Alibaba Nacos 组件&quot;">​</a></h2><p>Nacos 是 Dynamic Naming and Configuration Service 的缩写，动态命名和配置服务。</p><p>Nacos 是阿里开源的注册中心 + 配置中心服务。</p><p>Nacos 官网地址：<a href="https://nacos.io/zh-cn/" target="_blank" rel="noreferrer">https://nacos.io/zh-cn/</a></p><h2 id="docker-安装-nacos-使用-mysql-数据库" tabindex="-1">Docker 安装 Nacos（使用 Mysql 数据库） <a class="header-anchor" href="#docker-安装-nacos-使用-mysql-数据库" aria-label="Permalink to &quot;Docker 安装 Nacos（使用 Mysql 数据库）&quot;">​</a></h2><ol><li>下载 Nacos 镜像</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nacos/nacos-server:v2.2.0-slim</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nacos/nacos-server:v2.2.0-slim</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>为什么下载 slim 版本：因为使用的 Mac M1，需要使用支持 arm 架构的镜像。</p></div><ol start="2"><li>获取 Nacos 数据库初始化 SQL 文件</li></ol><p>方式一：从 github 中下载：<a href="https://github.com/alibaba/nacos/blob/master/config/src/main/resources/META-INF/nacos-db.sql" target="_blank" rel="noreferrer">链接</a></p><p>方式二：从 Nacos 的 <a href="https://github.com/alibaba/nacos/releases/tag/2.2.0" target="_blank" rel="noreferrer">Release</a> 版本中下载压缩包版本，<code>conf</code> 文件夹下的 <code>mysql-schema.sql</code> 文件即为 Mysql 数据库初始化脚本；</p><p>方式三：从容器的 <code>/usr/local/nacos/config</code> 路径下，获取 <code>mysql-schema.sql</code> 文件。</p><ol start="3"><li>数据库初始化</li></ol><p>使用第 2 步获取的 Mysql 文件初始化数据库。</p><ol start="4"><li>启动容器，通过配置 mysql 参数，使用外部的 Mysql 数据库存储配置</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nacos</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--restart=always </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">-p </span><span style="color:#79B8FF;">8848</span><span style="color:#9ECBFF;">:8848</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--link </span><span style="color:#9ECBFF;">mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">-v </span><span style="color:#9ECBFF;">/usr/local/nacos/logs:/home/nacos/logs</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">-v </span><span style="color:#9ECBFF;">/usr/local/nacos/data:/home/nacos/data</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">-v </span><span style="color:#9ECBFF;">/usr/local/nacos/config:/home/nacos/config</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">-e </span><span style="color:#9ECBFF;">MODE=standalone</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">-e </span><span style="color:#9ECBFF;">SPRING_DATASOURCE_PLATFORM=mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">-e </span><span style="color:#9ECBFF;">MYSQL_SERVICE_HOST=</span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">-e </span><span style="color:#9ECBFF;">MYSQL_SERVICE_PORT=</span><span style="color:#79B8FF;">3306</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">-e </span><span style="color:#9ECBFF;">MYSQL_SERVICE_DB_NAME=zeus_nacos</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">-e </span><span style="color:#9ECBFF;">MYSQL_SERVICE_USER=root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">-e </span><span style="color:#9ECBFF;">MYSQL_SERVICE_PASSWORD=root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">nacos/nacos-server:v2.2.0-slim</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nacos</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--restart=always </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-p </span><span style="color:#005CC5;">8848</span><span style="color:#032F62;">:8848</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--link </span><span style="color:#032F62;">mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-v </span><span style="color:#032F62;">/usr/local/nacos/logs:/home/nacos/logs</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-v </span><span style="color:#032F62;">/usr/local/nacos/data:/home/nacos/data</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-v </span><span style="color:#032F62;">/usr/local/nacos/config:/home/nacos/config</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-e </span><span style="color:#032F62;">MODE=standalone</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-e </span><span style="color:#032F62;">SPRING_DATASOURCE_PLATFORM=mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-e </span><span style="color:#032F62;">MYSQL_SERVICE_HOST=</span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-e </span><span style="color:#032F62;">MYSQL_SERVICE_PORT=</span><span style="color:#005CC5;">3306</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-e </span><span style="color:#032F62;">MYSQL_SERVICE_DB_NAME=zeus_nacos</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-e </span><span style="color:#032F62;">MYSQL_SERVICE_USER=root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">-e </span><span style="color:#032F62;">MYSQL_SERVICE_PASSWORD=root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">nacos/nacos-server:v2.2.0-slim</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="5"><li>如果使用内置数据库启动</li></ol><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nacos</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--restart=always</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8848</span><span style="color:#9ECBFF;">:8848</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">nacos/nacos-server:v2.2.0-slim</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nacos</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--restart=always</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8848</span><span style="color:#032F62;">:8848</span><span style="color:#24292E;">  </span><span style="color:#032F62;">nacos/nacos-server:v2.2.0-slim</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="源码启动-nacos-使用-mysql-数据库" tabindex="-1">源码启动 Nacos（使用 Mysql 数据库） <a class="header-anchor" href="#源码启动-nacos-使用-mysql-数据库" aria-label="Permalink to &quot;源码启动 Nacos（使用 Mysql 数据库）&quot;">​</a></h2><ol><li>下载 Nacos 源码</li></ol><p>从 Github Release 中下载源码压缩包 <a href="https://github.com/alibaba/nacos/releases/tag/2.0.3" target="_blank" rel="noreferrer">Source code.zip</a>(一定要使用稳定版本，推荐 2.0.3)，并解压缩到本地；</p><p><code>nacos</code> 目录下的 <code>console</code> 文件夹即为启动 Nacos 的模块，其主类 <code>Nacos</code> 为启动类。</p><ol start="2"><li>编译源码</li></ol><p>依次执行 maven 的 clear 和 compile 命令（可跳过 test），耐心等待。</p><ol start="3"><li>设置单机模式</li></ol><p>单机启动有两种方法：</p><ul><li>在 main 方法中，添加属性设置，设置为单机启动：</li></ul><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] args) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 单机模式启动</span></span>
<span class="line"><span style="color:#E1E4E8;">    System.</span><span style="color:#B392F0;">setProperty</span><span style="color:#E1E4E8;">(Constants.STANDALONE_MODE_PROPERTY_NAME, </span><span style="color:#9ECBFF;">&quot;true&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    SpringApplication.</span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">(Nacos.class, args);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] args) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 单机模式启动</span></span>
<span class="line"><span style="color:#24292E;">    System.</span><span style="color:#6F42C1;">setProperty</span><span style="color:#24292E;">(Constants.STANDALONE_MODE_PROPERTY_NAME, </span><span style="color:#032F62;">&quot;true&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    SpringApplication.</span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">(Nacos.class, args);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>或者在 idea 运行配置中，添加 VM 参数：</li></ul><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">-Dstandalone</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">-Dstandalone</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="4"><li>启动 Nacos</li></ol><p>执行 <code>console</code> 模块的 <code>Nacos</code> 类的 <code>main</code> 方法，如果有缺失类和方法的情况，应该是没有编译成功导致的，尝试重复第 2 步。</p><ol start="5"><li>打开 Nacos 界面</li></ol><p>Nacos 本地的地址默认为 <code>http://localhost:8848/nacos/index.html</code></p><p>默认的账号密码皆为 <code>nacos</code>。</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>如果想将 Nacos 单独拎出来，放入自己的工程中，会出现从无法找到 Nacos 其他基础组件的问题，可以使用第三方 Mavne 库 <code>io.spring.nacos</code>，具体可以参考这篇文章 <a href="https://www.cnblogs.com/huilangyizu/articles/16665305.html" target="_blank" rel="noreferrer">若依 + nacos 源码启动</a>。</p></div>`,42),e=[p];function c(r,t,i,E,y,d){return a(),n("div",null,e)}const u=s(o,[["render",c]]);export{b as __pageData,u as default};
